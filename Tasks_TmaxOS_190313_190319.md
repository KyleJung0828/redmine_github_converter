## Done (20190313 - 20190319)

- File Dialog 저장 오류
  - 현상:
    - 다른 이름으로 저장 시 FileDialog에서 여러 조건에 따라 드롭다운 필터 (ExtensionFilter)를 보여주는데 (e.g., 현재 작업 중인 파일 확장자가 .xlsx라면 다른 이름으로 저장 시 .xlsx를 기본으로 보여줌), 파일을 어떤 확장자로 저장한 후에도 (e.g., .tls --> .xlsx) 올바른 확장자를 보여주지 못하는 문제.
    - Normal Zone에서만 재현되었으나, 정확한 원인은 zone이 아니기 때문에 수정해야 함.
  - 정상 동작 (MS 제품 기준):
    - 만약 Option Dialog를 통해 기본 저장 확장자를 설정해놓은 상태라면, 새 문서를 저장할 때 해당 기본 확장자를 보여주고, 이미 고유의 확장자로 저장된 파일을 다른 이름으로 저장할 때는 저장된 파일의 확장자를 보여주도록 동작함.
    - 예를 들어, ToCell 빈 문서를 열고 (.tls), Option Dialog를 통해 기본 확장자를 xlsx로 지정한 후, 다른 이름으로 저장 button을 누르면 xlsx로 저장하도록 보여주고, 이미 tls로 저장된 파일을 열어 다른 이름으로 저장 button을 누르면 자신의 확장자인 tls로 저장하도록 보여줌. (우선 순위는 현재 파일 확장자 > Option Dialog를 통해 설정한 기본 확장자 > App 기본 확장자)
  - 원인:
    - 새 문서를 가지고 작업 중인지, 아니면 미리 저장된 문서를 열어 작업 중인지 구분하는 변수가 있고, 해당 변수를 통해 현재 파일 확장자를 보여줄지, 사용자가 지정한 기본 확장자를 보여줄지 결정함. 하지만 새 문서를 가지고 작업 중 저장했을 때 이 변수가 변경되지 않아 계속해서 사용자가 지정한 기본 확장자를 보여주고 있었음.
    - 또한 새 문서를 가지고 작업 중 저장했을 때 현재 파일의 이름을 기록하는 객체가 아무도 없었기 때문에, 현재 파일 이름을 가지고 확장자를 보여주는 로직이 작동하지 않았음.
  - 해결:
    - 저장 관련 명령 1회 수행 ((1)저장, (2)다른 이름으로 저장, (3)자동 저장)성공 시, OfficeApp이 FileLoading중을 나타내는 상태 및 현재 파일의 이름을 관리하도록 수정
  - 기타:
    - 새 문서를 저장할 때 기본 확장자를 사용자에게 보여주기 위해 RegistryManager를 통해 App 단위로 등록된 기본 확장자를 구하게 되는데, 알 수 없는 이유로 인해 ToCell에 대한 기본 확장자가 .tpt로 지정되어 있는 오류가 있음. (App 단위 Registry이기 때문에 사용자별로 다를 수 있으나, 원인 불명)
- 현재 작업 중인 문서의 확장자가 MS/ToOffice 확장자가 아닌 경우, File Dialog에서 제대로 된 기본 확장자를 보여주지 못하는 오류 수정
  - 현상:
    - 기존에는 MS 제품인지 확인하는 로직이 "ToOffice 제품 확장자가 아닐 경우에 MS 제품이다" 라고 되어 있는데, ToOffice 제품 확장자가 아님에도 불구하고 MS 제품이 아닌 경우도 존재하기 때문에 틀린 로직임 (e.g., csv는 ToOffice 제품이 아니지만 MS 제품도 아님).
  - 원인:
    - MS 제품일 경우, File Dialog의 확장자 Filter Index (기본으로 보여주는 확장자)를 1번으로 지정하도록 hard coding되어 있는데, Filter Item을 iteration하면서 내가 보여줘야 하는 확장자가 속한 index를 지정해야 함. 하지만 Filter Item를 담고 있는 container에 접근이 불가하여 다른 방법을 모색.
  - 해결 방안:
    - Save File Dialog를 띄울 때, 각 모듈에서 ExtensionFilter를 만드는데, 이를 Filter Item에 하나씩 넣을 때 비교하도록 함. (Filter Item에 넣은 역순으로 Filter Item Contents View에 나타남)
  - 기타:
    - 각 모듈에서 Override하던 MS확장자 검사 로직의 용도가 아예 사라졌고, 모듈 별로 검사해야할 필요성도 없어진 것으로 판단됨. 처리 정책 고려.
    - pdf의 경우, export only 개념으로 저장이 작동해야 하므로, 새 문서를 pdf로 저장했다고 해도 export만 했기 때문에 현재 작업하고 있는 문서의 확장자가 pdf로 변하면 안 됨. (기능 개발 필요)
